
<!DOCTYPE html>
<html>
<head>
<select id="d3-dropdown" <p>How Many Impression per Complaint</p>>
  <option value=0>Psychiatric Problem</option>
  <option value=1>Sick Person</option>
  <option value=2>Falls</option>
  <option value=3>Breathing Problem</option>
  <option value=4>Chest Pain</option>
</select>

<p id="selected-dropdown"></p>

<style>
</style>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script>
d3.csv("Complaints4Pareto.csv").then(function(data) {

//consulted http://learnjsdata.com/group_data.html, https://bl.ocks.org/d3noob/7030f35b72de721622b8 to code the following

//returns impressions for given complaint
  var complaintImpressionCount = d3.nest()
  .key(function(d) { return d.complaint; })
  .key(function(d) { return d.impression; })
  .rollup(function(v) { return v.length; })
  .entries(data);
//console.log(JSON.stringify(complaintImpressionCount));

h = 600;
w = 900;

i =0; //x key
j = 1; //y value

initChart = 0;

d3.select("#selected-dropdown").text("Choose Complaint");

d3.select("select")
  .on("change",function(d){
    var selected = d3.select("#d3-dropdown").node().value;
    console.log( selected );
   updateData();
    d3.select("#selected-dropdown").text(complaintImpressionCount[selected].values.length +" "+ complaintImpressionCount[selected].key +JSON.stringify(complaintImpressionCount[selected].values));
})

d3.select("#d3-dropdown").node().value; 


var svg = d3.select("body")
.append("svg")
.attr("width", w)
.attr("height", h);

var padding = 40;

var xscale = d3.scaleLinear()
.domain([0, (complaintImpressionCount, function(d){ complaintImpressionCount[initChart].values.length;})])
.range([padding, w-padding]);

console.log(complaintImpressionCount[initChart]); //need to update with select

// make a list of values to determine the y scale
let valList = (complaintImpressionCount[initChart].values).map(({ value }) => value)// need to update with select
console.log(valList);

var yscale = d3.scaleLinear()
.domain([0, d3.max(valList)])
.range([h- padding,padding]);

var yrscale = d3.scaleLinear()
.domain([0, 100])
.range([h- padding,padding]);

var xAxis = d3.axisBottom()
.scale(xscale)
.ticks(5);

var yAxis = d3.axisLeft()
.scale(yscale)
.ticks(5);

var yAxisr = d3.axisRight()
.scale(yrscale)
.ticks(5);

svg.append("g")
.attr("class", "x axis")
.attr("transform", "translate(0," +( h-padding) + ")")
.call(xAxis);

svg.append("text")             
 .attr("transform",
      "translate(" + (w/2) + " ," + (h-3) + ")")
      .style("text-anchor", "middle")
      .text("Impression");

svg.append("g")
.attr("class", "y axis")
.attr("transform", "translate(" + padding + ",0)")
.call(yAxis);

 svg.append("text")
.attr("transform", "rotate(-90)")
.attr("y", 0)
.attr("x",0 - (h / 2))
.attr("dy", "1em")
.style("text-anchor", "middle")
.text("Value");

svg.append("g")
.attr("class", "y axis")
.attr("transform", "translate(  " + (w-padding) + ")")
.call(yAxisr);

svg.append("text")
.attr("transform", "rotate(-90)")
.attr("y", w -20)
.attr("x",0 - (h / 2))
.attr("dy", "1em")
.style("text-anchor", "middle")
.text("Percent");

function updateData() {

    // Select the section to apply changes to
    var svg = d3.select("body").transition();

    // Make the changes
        svg.selectAll("rect")   // change the line
            .duration(750);
        svg.select("xAxis") // change the x axis
            .duration(750)
            .call(xAxis);
        svg.select("yAxis") // change the y axis
            .duration(750)
            .call(yAxis);

  }






//returns path by complaint
var complaintsNest = d3.nest()
  .key(function(d) { return d.complaint; })
  .entries(data);

//returns path by impressions 
var impressionsNest = d3.nest()
.key(function(d) { return d.impression;})
.entries(data);

//returns path by diagnosis
var diagnosesNest = d3.nest()
.key(function(d) {return d.diagnosis;})
.entries(data);


//returns counts of each complaint
var complaintCount = d3.nest()
  .key(function(d) { return d.complaint; })
  .rollup(function(v) { return v.length; })
  .entries(data);
//console.log(JSON.stringify(complaintCount));
         
//returns counts of each impression
var impressionCount = d3.nest()
  .key(function(d) { return d.impression; })
  .rollup(function(v) { return v.length; })
  .entries(data);
//console.log(JSON.stringify(impressionCount));

//returns counts of each diagnosis
var diagnosisCount = d3.nest()
  .key(function(d) { return d.diagnosis; })
  .rollup(function(v) { return v.length; })
  .entries(data);
//console.log(JSON.stringify(diagnosisCount));

//returns impressions for given complaint
//var complaintImpressionCount = d3.nest()
  //.key(function(d) { return d.complaint; })
//.key(function(d) { return d.impression; })
  //.rollup(function(v) { return v.length; })
  //.entries(data);
//console.log(JSON.stringify(complaintImpressionCount));

//returns diagnoses for given impression
var impressionDiagnosisCount = d3.nest()
  .key(function(d) { return d.impression; })
.key(function(d) { return d.diagnosis; })
  .rollup(function(v) { return v.length; })
  .entries(data);
//console.log(JSON.stringify(impressionDiagnosisCount));

//returns diagnoses for given complaint
var complaintDiagnosisCount = d3.nest()
  .key(function(d) { return d.complaint; })
.key(function(d) { return d.diagnosis; })
  .rollup(function(v) { return v.length; })
  .entries(data);

//returns an entire tree based on the complaint all the way through diagnosis
var CIDCount = d3.nest()
  .key(function(d) { return d.complaint; })
  .key(function(d) { return d.impression; })
  .key(function(d) { return d.diagnosis; })
  .rollup(function(v) { return v.length; })
  .entries(data);

//The whole tree...
//console.log(JSON.stringify(CIDCount));
   
//console.log(JSON.stringify(complaintDiagnosisCount));
  

//returns the length of the result array, the count

//console.log("CID There are " +CIDCount.length +" top complaints from dispatch " + (JSON.stringify(d3.keys(CIDCount))));
console.log(CIDCount); //the top level
//console.log(CIDCount.length);



console.log("There are " +complaintDiagnosisCount[0].values.length +" diagnoses that result from the complaint " +complaintDiagnosisCount[0].key);
//console.log(complaintDiagnosisCount[0].key);
//console.log(complaintDiagnosisCount);

console.log("\n -- There are " +impressionDiagnosisCount[0].values.length +" diagnoses that result from the impression " +impressionDiagnosisCount[0].key);
//console.log(impressionDiagnosisCount[0].key);
//console.log(impressionDiagnosisCount);

//console.log(" \n -- There are " +complaintImpressionCount[0].values.length +" impressions that result from the complaint " +complaintImpressionCount[0].key);
//console.log(complaintImpressionCount[0].key);
//console.log(complaintImpressionCount);

//need to find the length of each array in the parent array and the key of the item.


d3.select("#selected-dropdown").text("Choose Complaint");

d3.select("select")
  .on("change",function(d){
    var selected = d3.select("#d3-dropdown").node().value;
    console.log( selected );
    d3.select("#selected-dropdown").text(complaintImpressionCount[selected].values.length +" "+ complaintImpressionCount[selected].key +JSON.stringify(complaintImpressionCount[selected].values));


})


//returns the count for a given impression for chosen complaint
console.log(complaintImpressionCount[0].values[0].value);

//returns the name of the impressions for the chosen complaint
console.log(complaintImpressionCount[0].values[0].key);

//returns the impressions and counts for chosen complaint
console.log(complaintImpressionCount[0].values);

});





</script>
</head>
<body>
    <div id="myViz">
        <svg id="mySvg" />
    </div>
</body>
</html>